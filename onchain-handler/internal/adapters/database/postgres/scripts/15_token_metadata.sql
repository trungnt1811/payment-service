CREATE TABLE IF NOT EXISTS token_metadata (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL UNIQUE,
    name VARCHAR(50) NOT NULL UNIQUE,
    icon_base64 TEXT,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

DO $$
BEGIN
    INSERT INTO token_metadata (symbol, name, icon_base64)
    VALUES 
        (
            'USDT', 
            'Tether USD',
            'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4BAMAAADLSivhAAAAJ1BMVEVTrpT///9RrZPI5d2h08Xt9/RwvKZktp+HxrRbspnf8Ou33dL5/PvhvdiBAAAELUlEQVRYw+2Zz08TQRTHJ0MDNJw2sJeyh8mEQAkX+SEq9QAFEQOXjVYJ4YTQgl4MKD8vRhBr4NCAof44NUSJxYNYooRbIyTEv8ounW5ndme6M1298W798dnv7MybN++9AZoPA1cwY8Z5LDaZrwY+3z9OxuOL8eRo36QifN6zmcIYYsuCs4OTCrBx+GYHA9tw+/JpXhbWbz6jUMtg3bopB4eGIQIOg2g6IwOH7mLAMfw84w0LWC7thPVfArZAr5ke8E0IhIbWK8MPdkAFa79TCQ69BBWtPiOGjRuoMgwXxPDZDvCw9jERrPcDTwuYAngcSNhrPqy/koHDJhceRzIwfM2D5YQLy2Vy4DMgaWMcuF8WDrjhxpQsHOx0wQdIFoarTlh2upjVKsFNQMEGHPAtFXiXhalRF4M1x5Br3ARuLj/23ZDA7pWff8TA5bmGL0SHyyPknG8CR4EKXPKTIhyaV4PbMhTchNRgOEDBB6rwKgVHgRoMWsqwPqUKt5o23AhUYdBpwxdIFYbbNnygDq/a8Hf1YTeUYIPZy2vdxK4XmfvkYx9zFoXzBNbnmSjzgdgnslnJxxQTp+pMAgvCV0MR/i4OZIB1Tg58jR/IBgh8UQ28TeCHSH3YcIbAX4G6MvhIYO7PEHcUs4UuzB1YDYF/uEEUTMcfF5V740sp6H5AB4GjjnwLLSZHc7STRI5HEtCRn7UQmHEwXDeb646MbCZWSk6SXpzdKHy1yWaz4SLMeCdazkVG5qzYXZ4wK2bvbeQib6DDPy2YCgXtW/vDKfKCzGxDHJzuO6GypdYiTMUR+Pj3W8wulWGvBX5/uxcxsYSFWzO3kHid4UJoygXPU4sXdTqJQcEtlLu1ueAG7QsWK+MnHLg8ltqMXq4RHMqFSsHkDJuasKd5vWeO+FOgL1uw/X7ic3uDpvHTNWH0UoGtjDbRs7lyubbgMoJcrnl6dvCbFjqhFro2z3OSU1MzJiJDyXhiaSWdTi8Virqh3Oe8ph/ynMThnoUCrvBXq5CcsIadjVnlnDFhlXgc93RvjL3kaHc2Roo4I5btPk7OiTYGZ0viYHqxtCUTKyks3pL8WEGCgdbFr5VqZMKQ4RGGHlYTPWdkQq/hEXp9Bf2Kx41A2T5u2INOTrnN5B6xcsr1ed7hLqncwE0r5JSptOICqSpTCU2j+jt3cpM4OWUqiXNuSm/lAD9xlVJmEtczpKbMpMyheTVlJlk3omrKLYICRUbZUaA0qykfiYoyCWVHUcYrB8XKu96FqFh5wLsEFsKuEpgz34HL0ybb7118a79dgYwk3imJst/w03CQbnXAMR9NlrD5r9s7/hpLvlpa/pppvtp4muangaj98WhdhjP/q2nqr13rr1Hsq0Xtrznury3PuxDA0hcC/q4i7EsQXM0liH39kqjq+sXnxc/VNRvf/gKoyeDii3298gAAAABJRU5ErkJggg=='
        ),
        (
            'USDC', 
            'USD Coin',
            'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAAAM1BMVEUndcr///8kdMr6/P7t9Ps9g9CjxOgxfM1LjNNcl9d/reDV5PWPuORtotvj7fi40e7I3PKaZpEfAAAG9UlEQVRo3u1bi5KjKhBlAEERwf//2quJINCniWZmNlW3xqrdrYqrJ3SffnfE14cu8Qf8B4wvpbTWIWx/KfWPgJWeo3HLNB7XtDgTZ61+FViF6JfRCiml2P9K/wo7Lj4G9TvAajbLIJ5g7fX4dFjMrH4cODxRRed6YoefBFazH1+gZuzRXzu2uALrhiuoCXtwV6BfA9+CzdDfBtb+JuyTaoPX3wJWcRJ3YZ/YYorqfWDt7FuwD2jrwrvA6yTfxt0FPq1vASszfAP2AT0YdR9Ye/tN3F3cPMc4YL2Ib+PuHFvCPeAwSdY33ft8CneAGdzdG08W3bEj68kZZHEdV0q7xQDl0du9DmayEJo5MwLWE4x8w9P9z4B0dneRamWcK0QWiFcSwh6PA2Bp59OvA+RFXwFGsizdEHvi590FWaFXF4ANeXJzvIUP6p344d5HcN+8Bl6JsBo3sAJa29I5Burh5bC+AqaElmOswjNkXqVF4GwptVtgRx8pgvqDuNhPVMnWSsXtVBc4EikVZ1FxsayHEpu1deQibewBEwuW7sRdl27YKCwOqUxOugNMLOnE3XMgkkvX55cbHRSP7HnguX33Kee5yYE29+m3a+LtvUWWw8wBq4ZZBRVjyym5KPj2gotzwzBZ8UvwJizHOdsHtUyDrUAW1tcwtTZmwR745KECyQgHvHMsMpSpjixYDZ//DSVBLHCJ3ISbSssFsG8EHVjn3QUuZdqexSPgUHMhC3odUJQ8gdHdzA4j8GFKYINYS77PIcwpVUdmGkBWmL1F65EMBVaVPmSKN2qhQbKqRPecB0D7zGx4nAK4VkdmVrREgSRX1iAa5S9eHbmgl4CSzs8RQcsR1SU0GmVhR4FlLbCkk0g8wcWVL2CgQVo+ZZ2AQ/1khJ+WwU2HeZ3PRg9RiUgMrkU5hAY41ufSzIGT6oOfBmvtMBnNkTAdGR8pA1cQydB16+aT6jf/v4fE/c9RHCmSiiUtN0r0NXB9N70/kncporekNVoFJLVEaFACsDdJmorPoUQzcnHKHe3AQQLnJUCyLBdMreygDSIqjVMHRmXKOQUXSBwGSzrzxdQYLm6XBy49IorGCtggFTsu+sfWieICOREJnkpQjGRriub2DNu5vPPgYuWND80fwBWNkh0E6oETJddLXbd0gup7pncIoP/jFi2Szng6u1FI3EKmOqvfPpXA9XdyHLfKeLr3zKdHA6IDfhBpAbaKgP2RWoI3jqEeTMzRLCNf14D8qAdssKOmZeGXegwpIlPJZTJ6FjggYAffBhtXM9P0dNRYE09uA8vR6Kv9R/kSWF8HfuRcKx33wCQYAus3gR8Nr33cswbdLelPHZtbrIbkKhJrsaUBrhj4zAOba1ZvqoBrE3co0WbQh2X9YnMQFDFrB1K7zOS5rrXDcysJ2P3Kvx0FicNXA9lJ4CZzrhypr555eYKwCH378xoec0yGQtS3H+qExooSAbtipW1VoN6nt4uE1krTvV6mhFKfnGgwUTGKa8DoPW3qE1B4aruWyQQbHXCZUla+6yR7CkUukoKkb+thIUbsHiTDJL2tn0pJl2HCXNnryeZEE2uDMljfKWFkisikdEqlTdh7i88rz5ba6imXSb5bwjRZt2b8b3IWWwyehu2acgMTdCNBhUyLtsZ2ItPqK1pVW7kYzmqR9PVznbVa2StTm2ryuK/cxfqYtuAyRP0K86IVkctC4jZhR4DOAzPXax2CVkRTTaZC2IB5YZv8qJW2XzJ7vXzRfGkr95kzkn0SX+x8qBBBHzv3X5sminnZYMvfDcaoLQOJqXuO9iUys5oDwwZbY2+prFbRwuiY0ymYpxjcxPIXmqi5XwSHiRIlkHTy0RCHaaLWtrO5r/S0uwl8Zv3mUtu4aVadrSXtaM+wAyxzzt/IkGuUk0752aEnyL0TZ9zGIvjRAGkv54kNcEzHPeLazsFNo6LOMISOf5Ky1BcdVS5m73xYfhHCMw3dSwOvUzpgVElq42rs2gipP/AiIz6bkdXL9Zt6w6fF7Y/4aDgqZm1f2nS2uuqdJkIK+WKoCca4ZUGs9w0EroQsp65ttHo9xqWd53plR60jnLtUU9zQmt+FwTUtdGW9sqMiWiEwzXLSG6N64JulWObLOwJ07Hp1OQGtY5Sj4f5WBOT+tXUMuICykSe1PnonVmsvKXh35WZ8Eog/8QP2Iu6dJaOt/HdRw/C8eQfFLPvIO0tGnTWjERqyHP0yYL92b61qL1KE5Poe+GP5I4tkn1ud+9yy4OfWI5kYfF3M7y+Efm4F9s2lX/H9pd/Ui7655mx/YM25twTIZiLrjyx2f26V/YPL+5/8uUL7A43q+t0faGTw/JOUYcg/SQm/+5OUatb1r3+E81PXH/D/H/g/hL9R6EblNbQAAAAASUVORK5CYII='
        )
    ON CONFLICT (symbol) DO NOTHING;
END;    
$$;

-- --- Separate DROP TRIGGER ---
DO $$
BEGIN
    IF EXISTS (
        SELECT 1
        FROM pg_trigger
        WHERE tgname = 'update_token_metadata_updated_at'
          AND tgrelid = 'token_metadata'::regclass
    ) THEN
        EXECUTE 'DROP TRIGGER update_token_metadata_updated_at ON token_metadata';
    END IF;
END;
$$;

-- --- Then CREATE TRIGGER separately ---
CREATE TRIGGER update_token_metadata_updated_at
BEFORE UPDATE ON token_metadata
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();